<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Cartes Smile - Multijoueur</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .modal {
            backdrop-filter: blur(4px);
        }
        .category-section {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .salary-card-selectable {
            cursor: pointer;
            transition: all 0.2s;
        }
        .salary-card-selectable:hover {
            transform: scale(1.05);
        }
        .salary-card-selected {
            border: 3px solid #10b981 !important;
            background-color: #d1fae5 !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-400 to-pink-500 min-h-screen">
    
    <!-- Modal de sÃ©lection de salaires pour achat -->
    <div id="salary-selection-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                ğŸ’° SÃ©lectionner les salaires Ã  dÃ©penser
            </h2>
            
            <div id="acquisition-card-display" class="mb-6 p-4 bg-green-50 rounded-lg border-2 border-green-300"></div>
            
            <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                <div class="flex justify-between items-center text-lg font-semibold">
                    <span>CoÃ»t minimum :</span>
                    <span class="text-blue-600" id="required-cost">0</span>
                </div>
                <div class="flex justify-between items-center text-lg font-semibold mt-2">
                    <span>Montant sÃ©lectionnÃ© :</span>
                    <span class="text-green-600" id="selected-amount">0</span>
                </div>
                <div class="mt-2 text-sm text-gray-600">
                    <span id="payment-status">SÃ©lectionnez vos salaires (minimum requis)</span>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="font-semibold mb-3 text-gray-700">Vos ressources disponibles :</h3>
                <div id="available-salaries-list" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="confirmSalarySelection()" id="confirm-salary-btn" class="flex-1 bg-green-500 text-white py-3 px-6 rounded-lg hover:bg-green-600 transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    âœ… Confirmer l'achat
                </button>
                <button onclick="closeSalaryModal()" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-all font-semibold">
                    Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de sÃ©lection de cible pour malus -->
    <div id="hardship-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                âš ï¸ Choisir une victime
            </h2>
            <div id="hardship-card-display" class="mb-6 p-4 bg-red-50 rounded-lg border-2 border-red-300"></div>
            <div class="mb-6">
                <h3 class="font-semibold mb-3 text-gray-700">Joueurs disponibles :</h3>
                <div id="target-players-list" class="space-y-2"></div>
            </div>
            <button onclick="closeHardshipModal()" class="w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-all font-semibold">
                Annuler
            </button>
        </div>
    </div>

    <!-- Modal Anniversaire - Don de salaire -->
    <div id="birthday-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                ğŸ‚ Anniversaire !
            </h2>
            <p id="birthday-message" class="text-center mb-4 text-gray-600"></p>
            <div class="mb-6">
                <h3 class="font-semibold mb-3 text-gray-700">Choisissez un salaire Ã  offrir :</h3>
                <div id="birthday-salaries-list" class="grid grid-cols-2 gap-2"></div>
            </div>
        </div>
    </div>

    <!-- Modal Troc - Choix du joueur -->
    <div id="troc-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                ğŸ”„ Troc
            </h2>
            <p class="text-center mb-4 text-gray-600">Choisissez un joueur avec qui Ã©changer une carte alÃ©atoire</p>
            <div id="troc-players-list" class="space-y-2"></div>
            <button onclick="closeTrocModal()" class="mt-4 w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-all font-semibold">
                Annuler
            </button>
        </div>
    </div>

    <!-- Modal Piston - Choix du mÃ©tier -->
    <div id="piston-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                ğŸ¯ Piston
            </h2>
            <p class="text-center mb-4 text-gray-600">Choisissez un mÃ©tier Ã  poser sans condition d'Ã©tudes</p>
            <div id="piston-jobs-list" class="grid grid-cols-2 gap-3"></div>
            <button onclick="closePistonModal()" class="mt-4 w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-all font-semibold">
                Annuler
            </button>
        </div>
    </div>

    <!-- Modal Vengeance - Choix de l'attaque et de la cible -->
    <div id="vengeance-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                âš”ï¸ Vengeance
            </h2>
            <div class="mb-6">
                <h3 class="font-semibold mb-3 text-gray-700">Vos attaques reÃ§ues :</h3>
                <div id="vengeance-hardships-list" class="space-y-2 mb-4"></div>
            </div>
            <div id="vengeance-targets-container" class="hidden">
                <h3 class="font-semibold mb-3 text-gray-700">Choisir la victime :</h3>
                <div id="vengeance-targets-list" class="space-y-2"></div>
            </div>
            <button onclick="closeVengeanceModal()" class="mt-4 w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-all font-semibold">
                Annuler
            </button>
        </div>
    </div>

    <!-- Modal Chance - Choix parmi 3 cartes -->
    <div id="chance-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-3xl w-full">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                ğŸ€ Chance
            </h2>
            <p class="text-center mb-4 text-gray-600">Choisissez une carte parmi les 3 suivantes</p>
            <div id="chance-cards-list" class="grid grid-cols-3 gap-4"></div>
        </div>
    </div>

    <!-- Modal Arc-en-ciel - Mode spÃ©cial -->
    <div id="arc-en-ciel-banner" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white px-8 py-4 rounded-lg shadow-2xl z-40">
        <div class="text-center">
            <div class="text-2xl font-bold mb-2">ğŸŒˆ Mode Arc-en-ciel actif !</div>
            <div class="text-sm mb-3">Vous pouvez jouer jusqu'Ã  3 cartes - <span id="arc-remaining">3</span> restante(s)</div>
            <button onclick="finishArcEnCiel()" class="bg-white text-purple-600 px-6 py-2 rounded-lg font-semibold hover:bg-gray-100">
                âœ… Terminer et repiocher
            </button>
        </div>
    </div>

    <!-- Modal Ã‰toile filante - Choix dans la dÃ©fausse -->
    <div id="star-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
                â­ Ã‰toile filante
            </h2>
            <p class="text-center mb-4 text-gray-600">Choisissez une carte de la dÃ©fausse Ã  poser (doit respecter les rÃ¨gles)</p>
            <div id="star-discard-list" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
            <button onclick="closeStarModal()" class="mt-4 w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-all font-semibold">
                Annuler
            </button>
        </div>
    </div>

    <!-- Ã‰cran de menu -->
    <div id="menu-screen" class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <div class="flex justify-center mb-6">
                <span class="text-6xl">ğŸ˜Š</span>
            </div>
            <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">Jeu de Cartes Smile</h1>
            
            <div class="space-y-4">
                <button onclick="showCreateGame()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 px-6 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 font-semibold text-lg shadow-lg">
                    ğŸ® CrÃ©er une partie
                </button>
                
                <button onclick="showJoinGame()" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-4 px-6 rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-105 font-semibold text-lg shadow-lg">
                    ğŸšª Rejoindre une partie
                </button>
            </div>
        </div>
    </div>

    <!-- Ã‰cran crÃ©ation de partie -->
    <div id="create-screen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <button onclick="backToMenu()" class="mb-4 text-gray-600 hover:text-gray-800">â† Retour</button>
            
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">CrÃ©er une partie</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Votre nom:</label>
                    <input type="text" id="host-name" value="Joueur 1" 
                           class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Nombre de joueurs:</label>
                    <select id="num-players" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
                        <option value="2">2 joueurs</option>
                        <option value="3">3 joueurs</option>
                        <option value="4">4 joueurs</option>
                        <option value="5">5 joueurs</option>
                    </select>
                </div>
                
                <button onclick="createGame()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 px-6 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 font-semibold text-lg shadow-lg">
                    CrÃ©er
                </button>
            </div>
        </div>
    </div>

    <!-- Ã‰cran rejoindre partie -->
    <div id="join-screen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <button onclick="backToMenu()" class="mb-4 text-gray-600 hover:text-gray-800">â† Retour</button>
            
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Rejoindre une partie</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Votre nom:</label>
                    <input type="text" id="join-name" value="Joueur" 
                           class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Code de la partie:</label>
                    <input type="text" id="game-code" placeholder="Ex: abc123" 
                           class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none uppercase">
                </div>
                
                <button onclick="joinGame()" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-4 px-6 rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-105 font-semibold text-lg shadow-lg">
                    Rejoindre
                </button>
            </div>
        </div>
    </div>

    <!-- Ã‰cran salle d'attente -->
    <div id="lobby-screen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full">
            <h2 class="text-3xl font-bold text-center mb-2 text-gray-800">Salle d'attente</h2>
            <div class="text-center mb-6">
                <p class="text-gray-600 mb-2">Code de la partie:</p>
                <div class="inline-block bg-purple-100 px-6 py-3 rounded-lg">
                    <span id="lobby-game-code" class="text-3xl font-bold text-purple-600"></span>
                </div>
                <p class="text-sm text-gray-500 mt-2">Partagez ce code avec vos amis</p>
            </div>
            
            <div class="mb-6">
                <h3 class="font-bold mb-3 text-lg">Joueurs connectÃ©s:</h3>
                <div id="lobby-players" class="space-y-2"></div>
            </div>
            
            <div id="start-button-container" class="hidden">
                <button onclick="startGame()" class="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white py-4 px-6 rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all transform hover:scale-105 font-semibold text-lg shadow-lg">
                    ğŸš€ DÃ©marrer la partie
                </button>
            </div>
            
            <div class="text-center text-gray-600 text-sm mt-4">
                <span id="players-count">En attente de joueurs...</span>
            </div>
        </div>
    </div>

    <!-- Ã‰cran de jeu -->
    <div id="game-screen" class="hidden p-4 max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
            <div class="flex justify-between items-center flex-wrap gap-2">
                <h2 id="current-player-name" class="text-2xl font-bold text-gray-800"></h2>
                <div class="flex gap-4 items-center flex-wrap">
                    <div class="bg-blue-500 text-white px-4 py-2 rounded">
                        Pioche: <span id="deck-count">0</span>
                    </div>
                    <div class="bg-gray-500 text-white px-4 py-2 rounded">
                        DÃ©fausse: <span id="discard-count">0</span>
                    </div>
                </div>
            </div>
            <div id="message" class="mt-2 bg-yellow-100 border-l-4 border-yellow-500 p-2 text-sm"></div>
            <!-- Casino -->
            <div id="casino-section" class="bg-gradient-to-br from-red-700 to-purple-900 rounded-lg shadow-2xl p-4 mb-4 hidden">
                <div class="text-center mb-4">
                    <h3 class="text-3xl font-bold text-yellow-400">ğŸ° CASINO ğŸ°</h3>
                    <p class="text-white text-sm mt-2" id="casino-status-text">Le casino est ouvert !</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <!-- Premier pari -->
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm border-2 border-yellow-400">
                        <h4 class="text-yellow-400 font-bold text-center mb-2">1er Pari</h4>
                        <div id="casino-first-bet-display" class="text-center text-white">
                            <p class="text-sm italic">En attente...</p>
                        </div>
                    </div>
                    
                    <!-- DeuxiÃ¨me pari -->
                    <div class="bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm border-2 border-yellow-400">
                        <h4 class="text-yellow-400 font-bold text-center mb-2">2e Pari</h4>
                        <div id="casino-second-bet-display" class="text-center text-white">
                            <p class="text-sm italic">En attente...</p>
                        </div>
                    </div>
                </div>
                
                <div id="casino-bet-button-container" class="mt-4 text-center hidden">
                    <button onclick="openCasinoBetModal()" class="bg-yellow-400 hover:bg-yellow-500 text-black font-bold px-8 py-3 rounded-lg transform hover:scale-105 transition-all shadow-lg">
                        ğŸ° Placer un pari
                    </button>
                </div>
            </div>
        </div>

        <!-- DerniÃ¨re carte dÃ©faussÃ©e -->
        <div id="last-discard-container" class="bg-white rounded-lg shadow-lg p-4 mb-4 hidden">
            <h3 class="font-bold mb-2">ğŸ—‘ï¸ DerniÃ¨re carte dÃ©faussÃ©e</h3>
            <div id="last-discard-card"></div>
        </div>

        <!-- Scores des joueurs -->
        <div id="players-scores" class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-4"></div>

        <!-- Actions disponibles -->
        <div id="actions-panel" class="bg-white rounded-lg shadow-lg p-4 mb-4">
            <h3 class="font-bold mb-3">ğŸ¯ Actions disponibles</h3>
            <div class="flex gap-3 flex-wrap">
                <button onclick="drawCard('deck')" id="draw-deck-btn" class="flex-1 min-w-[200px] bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                    ğŸ“š Piocher dans la pioche
                </button>
                <button onclick="drawCard('discard')" id="draw-discard-btn" class="flex-1 min-w-[200px] bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                    ğŸ—‘ï¸ Piocher dans la dÃ©fausse
                </button>
                <button onclick="skipTurn()" id="skip-turn-btn" class="flex-1 min-w-[200px] bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                    â­ï¸ Passer mon tour
                </button>
            </div>
        </div>

        <!-- Main du joueur -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
            <h3 class="font-bold mb-3">Votre main (<span id="hand-count">0</span> cartes)</h3>
            <div id="player-hand" class="flex flex-wrap gap-2"></div>
        </div>

        <!-- Cartes posÃ©es par catÃ©gories -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
            <h3 class="font-bold mb-3">Vos cartes posÃ©es</h3>
            
            <!-- Vie professionnelle -->
            <div class="category-section bg-blue-50">
                <h4 class="font-semibold text-blue-800 mb-2">ğŸ’¼ Vie professionnelle</h4>
                <div id="player-vie-pro" class="flex flex-wrap gap-2"></div>
            </div>
            
            <!-- Vie personnelle -->
            <div class="category-section bg-pink-50">
                <h4 class="font-semibold text-pink-800 mb-2">ğŸ’• Vie personnelle</h4>
                <div id="player-vie-perso" class="flex flex-wrap gap-2"></div>
            </div>
            
            <!-- Acquisitions -->
            <div class="category-section bg-green-50">
                <h4 class="font-semibold text-green-800 mb-2">ğŸ  Acquisitions</h4>
                <div id="player-acquisitions" class="flex flex-wrap gap-2"></div>
            </div>
            
            <!-- Salaire dÃ©pensÃ© -->
            <div class="category-section bg-gray-50">
                <h4 class="font-semibold text-gray-800 mb-2">ğŸ’¸ Salaires dÃ©pensÃ©s</h4>
                <div id="player-salaire-depense" class="flex flex-wrap gap-2"></div>
            </div>
            
            <!-- Cartes spÃ©ciales -->
            <div class="category-section bg-yellow-50">
                <h4 class="font-semibold text-yellow-800 mb-2">â­ Cartes spÃ©ciales</h4>
                <div id="player-speciales" class="flex flex-wrap gap-2"></div>
            </div>
        </div>

        <!-- Attaques reÃ§ues -->
        <div id="hardships-received-container" class="bg-red-50 rounded-lg shadow-lg p-4 mb-4 border-2 border-red-300">
            <h3 class="font-bold mb-3 text-red-700">ğŸ’¥ Attaques reÃ§ues sur moi</h3>
            <div id="hardships-received" class="flex flex-wrap gap-2"></div>
        </div>

        <!-- Autres joueurs -->
        <div id="other-players" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>

    <!-- Ã‰cran de fin -->
    <div id="end-screen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-center mb-6">
                <span class="text-8xl">ğŸ‰</span>
            </div>
            <h1 class="text-4xl font-bold text-center mb-2 text-gray-800">Partie TerminÃ©e !</h1>
            <h2 id="winner-name" class="text-2xl font-bold text-center mb-8 text-purple-600"></h2>
            <div id="final-scores" class="space-y-4"></div>
            <button onclick="location.reload()" class="mt-8 w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 px-6 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 font-semibold text-lg shadow-lg">
                Nouvelle Partie
            </button>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/constants.js') }}"></script>
    <script src="{{ url_for('static', filename='js/special_cards.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>